<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wordbox Web Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            background-color: #f4f7f6; /* Light grayish-cyan */
            color: #333;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top for longer content */
            min-height: 100vh;
            padding-top: 20px; /* Add some padding at the top */
        }

        .container {
            width: 90%;
            max-width: 800px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            padding: 20px 30px;
            text-align: center;
        }

        header h1 {
            color: #00796b; /* Teal accent */
            margin-bottom: 30px;
        }

        .hidden {
            display: none !important;
        }

        /* Series Selection */
        #series-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .series-card {
            background-color: #e0f2f1; /* Lighter teal */
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Center content vertically */
            min-height: 150px; /* Ensure cards have some height */
        }

        .series-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .series-card img {
            width: 100px;
            height: 100px; /* Fixed height */
            object-fit: cover; /* Or 'contain' depending on image aspect ratios */
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .series-card p {
            margin: 0;
            font-weight: 500;
            color: #004d40; /* Darker teal */
            font-size: 0.9em;
        }


        /* Lesson Screen */
        #lesson-screen {
            margin-top: 20px;
        }

        #video-player-container iframe {
            width: 100%;
            max-width: 560px; /* Standard video width */
            height: 315px; /* Standard 16:9 aspect ratio */
            border: none;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        #subtitle-text {
            font-size: 1.2em;
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e0f2f1;
            border-radius: 4px;
            color: #004d40;
        }

        #subtitle-text .keyword {
            font-weight: bold;
            text-decoration: underline;
            color: #00796b;
        }

        #question-title {
            font-size: 1.1em;
            margin-bottom: 15px;
            color: #555;
        }

        #answer-options button, #scramble-input, #submit-answer-button, #next-question-button {
            display: block;
            width: calc(100% - 22px); /* Account for padding/border */
            padding: 12px;
            margin: 8px auto;
            background-color: #00796b; /* Teal */
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        #answer-options button:hover, #submit-answer-button:hover, #next-question-button:hover {
            background-color: #004d40; /* Darker teal */
        }

        #scramble-input {
            background-color: white;
            color: #333;
            border: 1px solid #ccc;
            text-align: center;
        }

        #feedback-container {
            margin-top: 20px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .correct {
            color: #2e7d32; /* Green */
        }

        .incorrect {
            color: #c62828; /* Red */
        }

        /* Simple Celebration Canvas (Optional) */
        #celebration-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Allow clicks through */
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Wordbox English Demo</h1>
        </header>

        <section id="series-selection-screen">
            <h2>Choose a TV Series</h2>
            <div id="series-grid">
                <!-- TV series will be populated here by JavaScript -->
            </div>
        </section>

        <section id="lesson-screen" class="hidden">
            <div id="video-player-container">
                <!-- Getyarn iframe will be embedded here -->
            </div>
            <div id="question-container">
                <p id="subtitle-text"></p>
                <h3 id="question-title"></h3>
                <div id="answer-options">
                    <!-- Answer options will be populated here -->
                </div>
                <input type="text" id="scramble-input" class="hidden" placeholder="Unscramble the word">
                <button id="submit-answer-button">Submit</button>
                 <button id="next-question-button" class="hidden">Next Question</button>
            </div>
            <div id="feedback-container">
                <p id="feedback-text"></p>
            </div>
        </section>

        <!-- Minimal canvas for potential celebration - optional -->
        <canvas id="celebration-canvas" class="hidden"></canvas>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const seriesSelectionScreen = document.getElementById('series-selection-screen');
            const lessonScreen = document.getElementById('lesson-screen');
            const seriesGrid = document.getElementById('series-grid');
            const videoPlayerContainer = document.getElementById('video-player-container');
            const subtitleTextElement = document.getElementById('subtitle-text');
            const questionTitleElement = document.getElementById('question-title');
            const answerOptionsContainer = document.getElementById('answer-options');
            const scrambleInputElement = document.getElementById('scramble-input');
            const submitAnswerButton = document.getElementById('submit-answer-button');
            const nextQuestionButton = document.getElementById('next-question-button');
            const feedbackTextElement = document.getElementById('feedback-text');
            const celebrationCanvas = document.getElementById('celebration-canvas'); // Optional

            // --- DATA ---
            // Placeholder images. Replace with actual URLs if available.
            // For real "Top 20", an API like TMDb would be used.
            const tvSeriesData = [
                { id: 'breakingbad', name: 'Breaking Bad', image: 'https://via.placeholder.com/100x100/00796B/FFFFFF?Text=BB' },
                { id: 'friends', name: 'Friends', image: 'https://via.placeholder.com/100x100/FFC107/000000?Text=Friends' },
                { id: 'got', name: 'Game of Thrones', image: 'https://via.placeholder.com/100x100/607D8B/FFFFFF?Text=GoT' },
                { id: 'office', name: 'The Office (US)', image: 'https://via.placeholder.com/100x100/3F51B5/FFFFFF?Text=Office' },
                { id: 'strangerthings', name: 'Stranger Things', image: 'https://via.placeholder.com/100x100/F44336/FFFFFF?Text=ST' }
            ];

            // Manually curated lessons.
            // Getyarn video IDs are the part after "yarn.co/". E.g., for https://getyarn.io/yarn-clip/10c74db5-13a4-4568-ac4c-f53f15c65822, ID is "10c74db5-13a4-4568-ac4c-f53f15c65822"
            const lessonsData = {
                breakingbad: [
                    {
                        yarnId: '10c74db5-13a4-4568-ac4c-f53f15c65822', // "I am the one who knocks"
                        subtitle: "I am the one who knocks.",
                        keyword: "knocks",
                        type: "definition",
                        question: "Choose the correct definition of the underlined word in this context:",
                        options: [
                            { text: "To strike a surface noisily to attract attention.", correct: false },
                            { text: "Asserting dominance or control; being the instigator.", correct: true },
                            { text: "To criticize or find fault with.", correct: false }
                        ]
                    },
                    {
                        yarnId: '9f09f810-3a84-420a-b3a5-71f6e4f7d7ab', // "Say my name."
                        subtitle: "Say my name.",
                        keyword: "name",
                        type: "scramble",
                        question: "Order the scrambled letters of the underlined word:",
                        // Correct answer is the keyword itself
                    },
                    {
                        yarnId: 'd8b5b8f1-871c-4d64-8c40-679b7771ef0b', // "We're a family."
                        subtitle: "We're a family.",
                        keyword: "family",
                        type: "definition",
                        question: "Choose the correct definition of the underlined word:",
                        options: [
                            { text: "A group of people working together.", correct: false },
                            { text: "A criminal organization.", correct: false },
                            { text: "A group of parents and children living together.", correct: true }
                        ]
                    }
                ],
                friends: [
                    {
                        yarnId: '00a72770-55ea-49dd-b793-0356ques0118', // "How you doin'?"
                        subtitle: "How you doin'?",
                        keyword: "doin'",
                        type: "definition",
                        question: "What is 'doin'' a contraction of?",
                        options: [
                            { text: "Doing", correct: true },
                            { text: "Done", correct: false },
                            { text: "Donut", correct: false }
                        ]
                    }
                ]
                // Add more series and lessons here
            };

            let currentSeriesId = null;
            let currentLessonSet = [];
            let currentQuestionIndex = 0;
            let currentQuestion = null;

            // --- INITIALIZATION ---
            function init() {
                renderSeriesSelection();
                submitAnswerButton.addEventListener('click', handleSubmitAnswer);
                nextQuestionButton.addEventListener('click', loadNextQuestion);
            }

            // --- UI RENDERING ---
            function renderSeriesSelection() {
                seriesGrid.innerHTML = ''; // Clear previous
                tvSeriesData.forEach(series => {
                    const card = document.createElement('div');
                    card.className = 'series-card';
                    card.dataset.seriesId = series.id;
                    
                    const img = document.createElement('img');
                    img.src = series.image;
                    img.alt = series.name;
                    
                    const name = document.createElement('p');
                    name.textContent = series.name;
                    
                    card.appendChild(img);
                    card.appendChild(name);
                    
                    card.addEventListener('click', () => handleSeriesClick(series.id));
                    seriesGrid.appendChild(card);
                });
            }

            function handleSeriesClick(seriesId) {
                currentSeriesId = seriesId;
                currentLessonSet = lessonsData[currentSeriesId] || [];
                if (currentLessonSet.length === 0) {
                    alert("Sorry, no lessons available for this series yet!");
                    return;
                }
                currentQuestionIndex = 0;
                seriesSelectionScreen.classList.add('hidden');
                lessonScreen.classList.remove('hidden');
                loadNextQuestion();
            }

            function loadNextQuestion() {
                feedbackTextElement.textContent = '';
                feedbackTextElement.className = '';
                submitAnswerButton.classList.remove('hidden');
                nextQuestionButton.classList.add('hidden');
                scrambleInputElement.classList.add('hidden');
                scrambleInputElement.value = '';
                scrambleInputElement.disabled = false; // Re-enable input for next question

                if (currentQuestionIndex >= currentLessonSet.length) {
                    displayEndOfLesson();
                    return;
                }

                currentQuestion = currentLessonSet[currentQuestionIndex];
                displayQuestion(currentQuestion);
                currentQuestionIndex++;
            }

            function displayQuestion(question) {
                // Display video
                videoPlayerContainer.innerHTML = `<iframe src="https://getyarn.io/yarn-clip/${question.yarnId}/embed?autoplay=true&responsive=true" frameborder="0" allowfullscreen></iframe>`;
                
                // Display subtitle with keyword highlighted
                const highlightedSubtitle = question.subtitle.replace(
                    new RegExp(`\\b(${question.keyword})\\b`, 'gi'),
                    '<span class="keyword">$1</span>'
                );
                subtitleTextElement.innerHTML = highlightedSubtitle;
                questionTitleElement.textContent = question.question;
                answerOptionsContainer.innerHTML = ''; // Clear previous options

                if (question.type === "definition") {
                    scrambleInputElement.classList.add('hidden');
                    submitAnswerButton.classList.add('hidden'); // Hide generic submit for definition type
                    submitAnswerButton.textContent = "Submit Answer"; 
                    question.options.forEach(option => {
                        const button = document.createElement('button');
                        button.textContent = option.text;
                        button.dataset.correct = option.correct;
                        // Re-enable button (important if coming from scramble)
                        button.disabled = false; 
                        button.addEventListener('click', () => checkAnswerDefinition(option.correct));
                        answerOptionsContainer.appendChild(button);
                    });
                } else if (question.type === "scramble") {
                    const scrambledWord = scrambleString(question.keyword);
                    const p = document.createElement('p');
                    p.textContent = `Unscramble: ${scrambledWord}`;
                    answerOptionsContainer.appendChild(p);
                    scrambleInputElement.classList.remove('hidden');
                    submitAnswerButton.classList.remove('hidden');
                    submitAnswerButton.textContent = "Check Scramble";
                }
            }

            function handleSubmitAnswer() { // Primarily for scramble type
                if (currentQuestion.type === "scramble") {
                    checkAnswerScramble();
                }
                // If it was for definition, individual buttons handle it
            }


            function checkAnswerDefinition(isCorrect) {
                // Disable option buttons after selection for definition type
                answerOptionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);

                if (isCorrect) {
                    feedbackTextElement.textContent = "Correct! ðŸŽ‰";
                    feedbackTextElement.className = 'correct';
                    celebrate();
                    prepareForNextQuestion();
                } else {
                    feedbackTextElement.textContent = "Incorrect. Try again or check the video!";
                    feedbackTextElement.className = 'incorrect';
                     // For incorrect, we don't automatically show next question button
                    // User might want to re-watch or re-think.
                    // To allow progression even if wrong:
                    // prepareForNextQuestion(); 
                }
            }
            
            function checkAnswerScramble() {
                const userAnswer = scrambleInputElement.value.trim().toLowerCase();
                const correctAnswer = currentQuestion.keyword.toLowerCase();

                scrambleInputElement.disabled = true; // Disable input after submit

                if (userAnswer === correctAnswer) {
                    feedbackTextElement.textContent = "Correct! ðŸŽ‰";
                    feedbackTextElement.className = 'correct';
                    celebrate();
                    prepareForNextQuestion();
                } else {
                    feedbackTextElement.textContent = "Incorrect. Try unscrambling again!";
                    feedbackTextElement.className = 'incorrect';
                    // For incorrect, we don't automatically show next question button
                    // To allow progression even if wrong:
                    // prepareForNextQuestion();
                    // Or allow them to retry by re-enabling:
                    // scrambleInputElement.disabled = false; 
                    // For this demo, let's make them wait for 'Next Question' if they are wrong
                    // or they can retry if we don't call prepareForNextQuestion
                    prepareForNextQuestion(); // Let's enable next question even if wrong for flow
                }
            }
            
            function prepareForNextQuestion() {
                submitAnswerButton.classList.add('hidden');
                nextQuestionButton.classList.remove('hidden');
                // Ensure input is disabled if it was a scramble question and they submitted
                if (currentQuestion.type === "scramble") {
                    scrambleInputElement.disabled = true; 
                }
                // Ensure definition buttons are disabled
                answerOptionsContainer.querySelectorAll('button').forEach(btn => btn.disabled = true);
            }


            function displayEndOfLesson() {
                videoPlayerContainer.innerHTML = '';
                subtitleTextElement.textContent = "Lesson Complete!";
                questionTitleElement.textContent = `You've finished all questions for ${tvSeriesData.find(s => s.id === currentSeriesId)?.name || 'this series'}.`;
                answerOptionsContainer.innerHTML = '';
                scrambleInputElement.classList.add('hidden');
                submitAnswerButton.classList.add('hidden');
                nextQuestionButton.classList.add('hidden'); // Hide next question button
                
                const backButton = document.createElement('button');
                backButton.textContent = "Choose another series";
                backButton.addEventListener('click', () => {
                    lessonScreen.classList.add('hidden');
                    seriesSelectionScreen.classList.remove('hidden');
                    feedbackTextElement.textContent = '';
                });
                answerOptionsContainer.appendChild(backButton);
            }

            // --- UTILITIES ---
            function scrambleString(str) {
                let arr = str.split('');
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]]; // Swap
                }
                // Ensure it's not the same as original (for short words, might be tricky)
                if (arr.join('') === str && str.length > 1) {
                    return scrambleString(str); // Re-scramble
                }
                return arr.join('');
            }

            function celebrate() {
                // Simple console log celebration for now
                console.log("CELEBRATE!");
                
                const ctx = celebrationCanvas.getContext('2d');
                celebrationCanvas.classList.remove('hidden');
                celebrationCanvas.width = window.innerWidth;
                celebrationCanvas.height = window.innerHeight;
                
                const particles = [];
                for (let i = 0; i < 50; i++) {
                    particles.push({
                        x: celebrationCanvas.width / 2,
                        y: celebrationCanvas.height / 2,
                        vx: (Math.random() - 0.5) * 10,
                        vy: (Math.random() - 0.5) * 10 - 5, // Bias upwards
                        color: `hsl(${Math.random() * 360}, 70%, 60%)`,
                        size: Math.random() * 10 + 5,
                        life: 60 // frames
                    });
                }

                function animateConfetti() {
                    ctx.clearRect(0, 0, celebrationCanvas.width, celebrationCanvas.height);
                    let activeParticles = false;
                    particles.forEach(p => {
                        if (p.life > 0) {
                            activeParticles = true;
                            p.x += p.vx;
                            p.y += p.vy;
                            p.vy += 0.2; // Gravity
                            p.life--;
                            ctx.fillStyle = p.color;
                            ctx.beginPath();
                            ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                            ctx.fill();
                        }
                    });
                    if (activeParticles) {
                        requestAnimationFrame(animateConfetti);
                    } else {
                        celebrationCanvas.classList.add('hidden');
                        ctx.clearRect(0, 0, celebrationCanvas.width, celebrationCanvas.height); // Clear after animation
                    }
                }
                animateConfetti();
            }

            // --- START THE APP ---
            init();
        });
    </script>
</body>
</html>